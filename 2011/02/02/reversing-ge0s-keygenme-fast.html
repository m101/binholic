<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[Reversing] Ge0&#39;s KeygenMe fast</title>
  <meta name="description" content="Bonjour,">

  <link rel="stylesheet" href="/binholic/assets/css/main.css">
  <link rel="canonical" href="/binholic/2011/02/02/reversing-ge0s-keygenme-fast.html">
  <link rel="alternate" type="application/rss+xml" title="Binary World for Binary People :)" href="/binholic/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/binholic/">Binary World for Binary People :)</a>

    <!--
    <h2 class="site-subtitle">
        <span class="site-subtitle-quote">"empty
"</span>
        <span class="site-subtitle-author">- no_author -</span>
    </h2>
    -->

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      
      <div class="trigger">
        
          
          <a class="page-link" href="/binholic/about/">About</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <a class="page-link" href="/binholic/blog/">Blog</a>
      </div>
      
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">[Reversing] Ge0's KeygenMe fast</h1>
    <p class="post-meta"><time datetime="2011-02-02T17:19:00+01:00" itemprop="datePublished">Feb 2, 2011</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">m_101</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Bonjour,</p>

<p>Ce soir nous allons étudier rapidement un keygen me “basique”, c’est-à-dire sans aucunes obfuscation, anti-debugging ou autre “protections” particulières.</p>

<p>C’est un challenge du site Zenk-Sécurité, pour cette raison, je ne vais pas dévoiler mon keygen mais juste donner des pistes (fortement détaillées).
Seuls ceux qui auront résolu le challenge pourront avoir accès à mon keygen.
Ca forcera les “gens” à lire entièrement ce write-up et à taper dans le challenge un minimum ^^.</p>

<p>Le page du challenge se trouve : <a href="http://venom630.free.fr/keygenmefast/">ici</a>.</p>

<p>On nous dit que la page http://venom630.free.fr/keygenmefast/keygenmefast.php va nous envoyer un keygenme sous forme d’un fichier ELF (exécutable Linux donc).
Le pseudo dont il faut générer le sérial se trouve dans les entêtes HTTP:
<strong>X-Pseudo-Keygenmefast: 0vercl0k</strong> (par exemple)
Et pour finir, nous devons envoyer notre solution concaténée au pseudo sous la forme d’un hash SHA1.
http://venom630.free.fr/keygenmefast/verifkeygenmefast.php?solution=sha1.</p>

<p>De ces informations, nous pouvons tirer plusieurs hypothèses:</p>

<ul>
  <li>un binaire de base est utilisé</li>
  <li>certaines données vont changer</li>
</ul>

<p>Pour vérifier ces hypothèses, c’est somme toute assez simple, on va faire usage de diff et hexdump comme ci-dessous:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nv">$ </span>diff <span class="nt">-u</span> &lt;<span class="o">(</span>hexdump <span class="nt">-C</span> ./keygenmefast1<span class="o">)</span> &lt;<span class="o">(</span>hexdump <span class="nt">-C</span> ./keygenmefast2<span class="o">)</span></pre></td></tr></tbody></table></code></pre></figure>

<figure class="highlight"><pre><code class="language-diff" data-lang="diff"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="code"><pre><span class="gd">--- /dev/fd/63 2011-02-02 16:50:47.833079643 +0100
</span><span class="gi">+++ /dev/fd/62 2011-02-02 16:50:47.833079643 +0100
</span><span class="gu">@@ -91,25 +91,25 @@
</span> 000005a0  00 00 bb 42 a0 04 08 01  c3 8a 13 8b 7c 24 08 81  |...B........|$..|
 000005b0  c7 05 00 00 00 8a 37 38  f2 0f 85 ba fe ff ff 68  |......78.......h|
 000005c0  83 a0 04 08 e8 a7 fd ff  ff 31 c0 c9 c3 55 89 e5  |.........1...U..|
<span class="gd">-000005d0  8b 45 08 25 ff 00 00 00  34 49 25 3f 00 00 00 c9  |.E.%....4I%?....|
</span><span class="gi">+000005d0  8b 45 08 25 ff 00 00 00  34 13 25 3f 00 00 00 c9  |.E.%....4.%?....|
</span> 000005e0  c2 04 00 55 89 e5 81 ec  08 00 00 00 8b 4d 0c 8b  |...U.........M..|
 000005f0  75 08 01 ce 31 c0 e9 0b  00 00 00 4e 8a 16 81 e2  |u...1......N....|
 00000600  ff 00 00 00 01 d0 49 81  f9 ff ff ff ff 75 ec 34  |......I......u.4|
<span class="gd">-00000610  08 25 3f 00 00 00 c9 c2  08 00 55 89 e5 b8 01 00  |.%?.......U.....|
</span><span class="gi">+00000610  84 25 3f 00 00 00 c9 c2  08 00 55 89 e5 b8 01 00  |.%?.......U.....|
</span> 00000620  00 00 8b 75 08 8b 4d 0c  e9 0f 00 00 00 31 db 8a  |...u..M......1..|
 00000630  1e 80 e3 ff f7 e3 25 ff  00 00 00 46 49 81 f9 ff  |......%....FI...|
<span class="gd">-00000640  ff ff ff 75 e8 34 7e 25  3f 00 00 00 c9 c2 08 00  |...u.4~%?.......|
</span><span class="gi">+00000640  ff ff ff 75 e8 34 2f 25  3f 00 00 00 c9 c2 08 00  |...u.4/%?.......|
</span> 00000650  55 89 e5 81 ec 04 00 00  00 8b 75 08 8a 06 8b 4d  |U.........u....M|
 00000660  0c e9 09 00 00 00 46 8a  1e 38 c3 76 02 88 d8 49  |......F..8.v...I|
<span class="gd">-00000670  81 f9 ff ff ff ff 75 ee  34 a7 50 e8 b0 fc ff ff  |......u.4.P.....|
</span><span class="gi">+00000670  81 f9 ff ff ff ff 75 ee  34 ed 50 e8 b0 fc ff ff  |......u.4.P.....|
</span> 00000680  e8 fb fc ff ff 25 3f 00  00 00 c9 c2 08 00 55 89  |.....%?.......U.|
 00000690  e5 31 db 8b 75 08 8b 4d  0c 49 e9 1d 00 00 00 31  |.1..u..M.I.....1|
 000006a0  d2 8a 16 51 53 68 02 00  00 00 52 e8 58 00 00 00  |...QSh....R.X...|
 000006b0  5b 59 01 c3 81 e3 ff 00  00 00 46 49 81 f9 ff ff  |[Y........FI....|
<span class="gd">-000006c0  ff ff 75 db 89 d8 34 46  25 3f 00 00 00 c9 c2 08  |..u...4F%?......|
</span><span class="gi">+000006c0  ff ff 75 db 89 d8 34 77  25 3f 00 00 00 c9 c2 08  |..u...4w%?......|
</span> 000006d0  00 55 89 e5 31 c0 8b 75  08 81 fe 00 00 00 00 74  |.U..1..u.......t|
 000006e0  1e e8 9a fc ff ff 8b 4d  08 e9 07 00 00 00 51 e8  |.......M......Q.|
<span class="gd">-000006f0  8c fc ff ff 59 49 75 f6  25 ff 00 00 00 34 39 25  |....YIu.%....49%|
</span><span class="gi">+000006f0  8c fc ff ff 59 49 75 f6  25 ff 00 00 00 34 57 25  |....YIu.%....4W%|
</span> 00000700  3f 00 00 00 c9 c2 04 00  55 89 e5 8b 4d 0c b8 01  |?.......U...M...|
 00000710  00 00 00 81 f9 00 00 00  00 74 0f 8b 5d 08 f7 e3  |.........t..]...|
 00000720  e9 02 00 00 00 f7 e3 49  75 fb c9 c2 08 00 90 90  |.......Iu.......|
<span class="gu">@@ -145,11 +145,11 @@
</span> 00001010  76 83 04 08 86 83 04 08  00 00 00 00 00 00 00 00  |v...............|
 00001020  55 74 69 6c 69 73 61 74  69 6f 6e 20 3a 20 25 73  |Utilisation : %s|
 00001030  20 3c 70 73 65 75 64 6f  3e 20 3c 63 6c 65 66 3e  | &lt;pseudo&gt; &lt;clef&gt;|
<span class="gd">-00001040  0a 00 52 76 6e 64 35 56  78 4b 4e 44 45 6b 70 5a  |..Rvnd5VxKNDEkpZ|
-00001050  2b 31 67 71 53 54 2d 75  62 73 72 68 6d 43 42 33  |+1gqST-ubsrhmCB3|
-00001060  63 61 30 38 6c 37 55 6f  46 32 66 69 50 79 77 4d  |ca08l7UoF2fiPywM|
-00001070  6a 7a 57 59 41 58 48 49  51 34 4c 47 65 74 36 39  |jzWYAXHIQ4LGet69|
-00001080  4a 4f 00 42 72 61 76 6f  20 21 21 0a 00 00 00 00  |JO.Bravo !!.....|
</span><span class="gi">+00001040  0a 00 31 68 69 2b 59 42  65 56 61 4e 4c 33 44 4a  |..1hi+YBeVaNL3DJ|
+00001050  4d 45 58 7a 32 6c 74 50  5a 2d 78 6d 34 6f 47 53  |MEXz2ltPZ-xm4oGS|
+00001060  75 76 71 77 49 55 66 79  43 36 6a 70 6b 62 4b 54  |uvqwIUfyC6jpkbKT|
+00001070  35 6e 63 4f 57 73 46 39  72 67 38 64 52 48 37 30  |5ncOWsF9rg8dRH70|
+00001080  51 41 00 42 72 61 76 6f  20 21 21 0a 00 00 00 00  |QA.Bravo !!.....|
</span> 00001090  47 43 43 3a 20 28 55 62  75 6e 74 75 2f 4c 69 6e  |GCC: (Ubuntu/Lin|
 000010a0  61 72 6f 20 34 2e 34 2e  34 2d 31 34 75 62 75 6e  |aro 4.4.4-14ubun|
 000010b0  74 75 35 29 20 34 2e 34  2e 35 00 00 2e 73 68 73  |tu5) 4.4.5...shs|</pre></td></tr></tbody></table></code></pre></figure>

<p>Ainsi on remarque qu’on a 6 octets qui changent et une chaîne de 64 caractères aussi qui est générée. Ca n’a pas l’air d’être de la base64 (ne finit pas par des =).</p>

<p>On récupère donc les différents offsets de ces diffs :</p>

<ul>
  <li>offsets octets: 0x5d9, 0x610, 0x646, 0x679, 0x6c7, 0x6fe</li>
  <li>offset string: 0x1042
Et les valeurs correspondantes:</li>
  <li>octets: 0x13, 0x84, 0x2f, 0xed, 0x77, 0x57</li>
  <li>string:1hi+YBeVaNL3DJMEXz2ltPZ-xm4oGSuvqwIUfyC6jpkbKT5ncOWsF9rg8dRH70QAs</li>
</ul>

<p>On verra à quoi ils servent par la suite.</p>

<p>Analysons la routine principale:</p>

<figure class="highlight"><pre><code class="language-nasm" data-lang="nasm"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
</pre></td><td class="code"><pre><span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span> <span class="c">; =============== S U B R O U T I N E =======================================</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span> <span class="c">; Attributes: bp-based frame</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span> <span class="n">main</span>            <span class="n">proc</span> <span class="n">near</span>               <span class="c">; DATA XREF: start+17 o</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span> <span class="n">argc</span>            <span class="o">=</span> <span class="n">dword</span> <span class="n">ptr</span>  <span class="mi">8</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span> <span class="n">argv</span>            <span class="o">=</span> <span class="n">dword</span> <span class="n">ptr</span>  <span class="mi">0</span><span class="n">Ch</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048450</span>                 <span class="k">push</span>    <span class="n">ebp</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048451</span>                 <span class="k">mov</span>     <span class="n">ebp</span><span class="p">,</span> <span class="n">esp</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048453</span>                 <span class="k">mov</span>     <span class="n">eax</span><span class="p">,</span> <span class="err">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">argc</span><span class="err">]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048456</span>                 <span class="k">cmp</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">3</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804845</span><span class="n">B</span>                 <span class="k">jnb</span>     <span class="n">short</span> <span class="n">loc_8048485</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804845</span><span class="n">D</span>                 <span class="k">mov</span>     <span class="n">esi</span><span class="p">,</span> <span class="err">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">argv</span><span class="err">]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048460</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="p">[esi]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048462</span>                 <span class="k">sub</span>     <span class="n">esp</span><span class="p">,</span> <span class="mi">8</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048468</span>                 <span class="k">mov</span>     <span class="n">esi</span><span class="p">,</span> <span class="n">offset</span> <span class="n">format</span> <span class="c">; "Utilisation : %s &lt;pseudo&gt; &lt;clef&gt;\n"</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804846</span><span class="n">D</span>                 <span class="k">mov</span>     <span class="p">[esp],</span> <span class="n">esi</span>      <span class="c">; s</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048470</span>                 <span class="k">mov</span>     <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">4</span><span class="err">]</span><span class="p">,</span> <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048474</span>                 <span class="k">call</span>    <span class="n">_printf</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048479</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048479</span> <span class="n">main_exit</span><span class="o">:</span>                              <span class="c">; CODE XREF: main+6F j</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048479</span>                                         <span class="c">; main+9B j ...</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048479</span>                 <span class="k">mov</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">1</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804847</span><span class="n">E</span>                 <span class="k">mov</span>     <span class="n">ebx</span><span class="p">,</span> <span class="mi">1</span>          <span class="c">; status</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048483</span>                 <span class="k">int</span>     <span class="mi">80</span><span class="n">h</span>             <span class="c">; LINUX - sys_exit</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048485</span> <span class="c">; ---------------------------------------------------------------------------</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048485</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048485</span> <span class="n">loc_8048485</span><span class="o">:</span>                            <span class="c">; CODE XREF: main+B j</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048485</span>                 <span class="k">sub</span>     <span class="n">esp</span><span class="p">,</span> <span class="mi">0</span><span class="n">Ch</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804848</span><span class="n">B</span>                 <span class="k">mov</span>     <span class="n">ebx</span><span class="p">,</span> <span class="err">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">argv</span><span class="err">]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804848</span><span class="n">E</span>                 <span class="k">mov</span>     <span class="n">edx</span><span class="p">,</span> <span class="n">ebx</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048490</span>                 <span class="k">add</span>     <span class="n">edx</span><span class="p">,</span> <span class="mi">4</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048496</span>                 <span class="k">mov</span>     <span class="n">edx</span><span class="p">,</span> <span class="p">[edx]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048498</span>                 <span class="k">mov</span>     <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">4</span><span class="err">]</span><span class="p">,</span> <span class="n">edx</span>    <span class="c">; argv[1] &lt;=&gt; username</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804849</span><span class="n">C</span>                 <span class="k">mov</span>     <span class="n">edx</span><span class="p">,</span> <span class="n">ebx</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804849</span><span class="n">E</span>                 <span class="k">add</span>     <span class="n">edx</span><span class="p">,</span> <span class="mi">8</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">A4</span>                 <span class="k">mov</span>     <span class="n">edx</span><span class="p">,</span> <span class="p">[edx]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">A6</span>                 <span class="k">mov</span>     <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span><span class="p">,</span> <span class="n">edx</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">AA</span>                 <span class="k">mov</span>     <span class="n">esi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>    <span class="c">; argv[2] &lt;=&gt; usersserial</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">AE</span>                 <span class="k">push</span>    <span class="n">esi</span>             <span class="c">; userserial</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">AF</span>                 <span class="k">call</span>    <span class="n">_strlen</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">B4</span>                 <span class="k">add</span>     <span class="n">esp</span><span class="p">,</span> <span class="mi">4</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">BA</span>                 <span class="k">cmp</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">6</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">BF</span>                 <span class="k">jnz</span>     <span class="n">short</span> <span class="n">main_exit</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">C1</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">4</span><span class="err">]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">C5</span>                 <span class="k">push</span>    <span class="n">edi</span>             <span class="c">; username</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">C6</span>                 <span class="k">call</span>    <span class="n">_strlen</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">CB</span>                 <span class="k">add</span>     <span class="n">esp</span><span class="p">,</span> <span class="mi">4</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">D1</span>                 <span class="k">mov</span>     <span class="p">[esp],</span> <span class="n">eax</span>      <span class="c">; szUsername</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">D4</span>                 <span class="k">push</span>    <span class="n">eax</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">D5</span>                 <span class="k">call</span>    <span class="n">get_offset0</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">DA</span>                 <span class="k">mov</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">offset</span> <span class="n">hash</span> <span class="c">; "1hi+YBeVaNL3DJMEXz2ltPZ-xm4oGSuvqwIUfyC"...</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">DF</span>                 <span class="k">add</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">eax</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">E1</span>                 <span class="k">mov</span>     <span class="n">dl</span><span class="p">,</span> <span class="p">[ebx]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">E3</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>    <span class="c">; argv[2] &lt;=&gt; userserial</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">E7</span>                 <span class="k">mov</span>     <span class="n">dh</span><span class="p">,</span> <span class="p">[edi]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">E9</span>                 <span class="k">cmp</span>     <span class="n">dl</span><span class="p">,</span> <span class="n">dh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">EB</span>                 <span class="k">jnz</span>     <span class="n">short</span> <span class="n">main_exit</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">ED</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="p">[esp]</span>      <span class="c">; szUsername</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">F0</span>                 <span class="k">push</span>    <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">F1</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>    <span class="c">; argv[2] &lt;=&gt; userserial</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">F5</span>                 <span class="k">push</span>    <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">F6</span>                 <span class="k">call</span>    <span class="n">get_offset1</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080484</span><span class="n">FB</span>                 <span class="k">mov</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">offset</span> <span class="n">hash</span> <span class="c">; "1hi+YBeVaNL3DJMEXz2ltPZ-xm4oGSuvqwIUfyC"...</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048500</span>                 <span class="k">add</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">eax</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048502</span>                 <span class="k">mov</span>     <span class="n">dl</span><span class="p">,</span> <span class="p">[ebx]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048504</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048508</span>                 <span class="k">inc</span>     <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048509</span>                 <span class="k">mov</span>     <span class="n">dh</span><span class="p">,</span> <span class="p">[edi]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804850</span><span class="n">B</span>                 <span class="k">cmp</span>     <span class="n">dl</span><span class="p">,</span> <span class="n">dh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804850</span><span class="n">D</span>                 <span class="k">jnz</span>     <span class="n">main_exit</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048513</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="p">[esp]</span>      <span class="c">; szUsername</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048516</span>                 <span class="k">push</span>    <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048517</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>    <span class="c">; argv[2] &lt;=&gt; userserial</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804851</span><span class="n">B</span>                 <span class="k">push</span>    <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804851</span><span class="n">C</span>                 <span class="k">call</span>    <span class="n">get_offset2</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048521</span>                 <span class="k">mov</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">offset</span> <span class="n">hash</span> <span class="c">; "1hi+YBeVaNL3DJMEXz2ltPZ-xm4oGSuvqwIUfyC"...</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048526</span>                 <span class="k">add</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">eax</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048528</span>                 <span class="k">mov</span>     <span class="n">dl</span><span class="p">,</span> <span class="p">[ebx]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804852</span><span class="n">A</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804852</span><span class="n">E</span>                 <span class="k">add</span>     <span class="n">edi</span><span class="p">,</span> <span class="mi">2</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048534</span>                 <span class="k">mov</span>     <span class="n">dh</span><span class="p">,</span> <span class="p">[edi]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048536</span>                 <span class="k">cmp</span>     <span class="n">dl</span><span class="p">,</span> <span class="n">dh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048538</span>                 <span class="k">jnz</span>     <span class="n">main_exit</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804853</span><span class="n">E</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="p">[esp]</span>      <span class="c">; szUsername</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048541</span>                 <span class="k">push</span>    <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048542</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>    <span class="c">; argv[2] &lt;=&gt; userserial</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048546</span>                 <span class="k">push</span>    <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048547</span>                 <span class="k">call</span>    <span class="n">get_offset3</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804854</span><span class="n">C</span>                 <span class="k">mov</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">offset</span> <span class="n">hash</span> <span class="c">; "1hi+YBeVaNL3DJMEXz2ltPZ-xm4oGSuvqwIUfyC"...</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048551</span>                 <span class="k">add</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">eax</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048553</span>                 <span class="k">mov</span>     <span class="n">dl</span><span class="p">,</span> <span class="p">[ebx]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048555</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048559</span>                 <span class="k">add</span>     <span class="n">edi</span><span class="p">,</span> <span class="mi">3</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804855</span><span class="n">F</span>                 <span class="k">mov</span>     <span class="n">dh</span><span class="p">,</span> <span class="p">[edi]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048561</span>                 <span class="k">cmp</span>     <span class="n">dl</span><span class="p">,</span> <span class="n">dh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048563</span>                 <span class="k">jnz</span>     <span class="n">main_exit</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048569</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="p">[esp]</span>      <span class="c">; szUsername</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804856</span><span class="n">C</span>                 <span class="k">push</span>    <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804856</span><span class="n">D</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>    <span class="c">; argv[2] &lt;=&gt; userserial</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048571</span>                 <span class="k">push</span>    <span class="n">edi</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048572</span>                 <span class="k">call</span>    <span class="n">get_offset4</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048577</span>                 <span class="k">mov</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">offset</span> <span class="n">hash</span> <span class="c">; "1hi+YBeVaNL3DJMEXz2ltPZ-xm4oGSuvqwIUfyC"...</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804857</span><span class="n">C</span>                 <span class="k">add</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">eax</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804857</span><span class="n">E</span>                 <span class="k">mov</span>     <span class="n">dl</span><span class="p">,</span> <span class="p">[ebx]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048580</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>    <span class="c">; argv[2] &lt;=&gt; userserial</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048584</span>                 <span class="k">add</span>     <span class="n">edi</span><span class="p">,</span> <span class="mi">4</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804858</span><span class="n">A</span>                 <span class="k">mov</span>     <span class="n">dh</span><span class="p">,</span> <span class="p">[edi]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804858</span><span class="n">C</span>                 <span class="k">cmp</span>     <span class="n">dl</span><span class="p">,</span> <span class="n">dh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804858</span><span class="n">E</span>                 <span class="k">jnz</span>     <span class="n">main_exit</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048594</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">4</span><span class="err">]</span>    <span class="c">; argv[1] &lt;=&gt; username</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048598</span>                 <span class="k">xor</span>     <span class="n">edx</span><span class="p">,</span> <span class="n">edx</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804859</span><span class="n">A</span>                 <span class="k">mov</span>     <span class="n">dl</span><span class="p">,</span> <span class="p">[edi]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804859</span><span class="n">C</span>                 <span class="k">push</span>    <span class="n">edx</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804859</span><span class="n">D</span>                 <span class="k">call</span>    <span class="n">get_offset5</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">A2</span>                 <span class="k">mov</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">offset</span> <span class="n">hash</span> <span class="c">; "1hi+YBeVaNL3DJMEXz2ltPZ-xm4oGSuvqwIUfyC"...</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">A7</span>                 <span class="k">add</span>     <span class="n">ebx</span><span class="p">,</span> <span class="n">eax</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">A9</span>                 <span class="k">mov</span>     <span class="n">dl</span><span class="p">,</span> <span class="p">[ebx]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">AB</span>                 <span class="k">mov</span>     <span class="n">edi</span><span class="p">,</span> <span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">8</span><span class="err">]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">AF</span>                 <span class="k">add</span>     <span class="n">edi</span><span class="p">,</span> <span class="mi">5</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">B5</span>                 <span class="k">mov</span>     <span class="n">dh</span><span class="p">,</span> <span class="p">[edi]</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">B7</span>                 <span class="k">cmp</span>     <span class="n">dl</span><span class="p">,</span> <span class="n">dh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">B9</span>                 <span class="k">jnz</span>     <span class="n">main_exit</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">BF</span>                 <span class="k">push</span>    <span class="n">offset</span> <span class="n">aBravo</span>   <span class="c">; "Bravo !!\n"</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">C4</span>                 <span class="k">call</span>    <span class="n">_printf</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">C9</span>                 <span class="k">xor</span>     <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">CB</span>                 <span class="k">leave</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">CC</span>                 <span class="k">retn</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">CC</span> <span class="n">main</span>            <span class="n">endp</span> <span class="c">; sp-analysis failed</span></pre></td></tr></tbody></table></code></pre></figure>

<p>On remarque que des blocs ont le même pattern:</p>

<ul>
  <li>appel d’une fonction qui calcule un dword</li>
  <li>ajout de ce dword à hash</li>
  <li>comparaison du caractère calculé et du caractère entré
  -&gt; si incorrect on sort du keygen
  -&gt; si correct on continue</li>
  <li>lorsqu’on arrive à la fin, on obtient un “Bravo !!\n” ^^</li>
</ul>

<p>Maintenant, en analysant chaque fonction de calcul d’offset, on remarque les choses suivantes:</p>

<p>get_offset0:</p>

<figure class="highlight"><pre><code class="language-nasm" data-lang="nasm"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">D8</span>                 <span class="k">xor</span>     <span class="n">al</span><span class="p">,</span> <span class="mi">13</span><span class="n">h</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">DA</span>                 <span class="k">and</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">3</span><span class="n">Fh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">DF</span>                 <span class="k">leave</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">E0</span>                 <span class="k">retn</span>    <span class="mi">4</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080485</span><span class="n">E0</span> <span class="n">get_offset0</span>     <span class="n">endp</span></pre></td></tr></tbody></table></code></pre></figure>

<p>get_offset1:</p>

<figure class="highlight"><pre><code class="language-nasm" data-lang="nasm"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804860</span><span class="n">F</span>                 <span class="k">xor</span>     <span class="n">al</span><span class="p">,</span> <span class="mi">84</span><span class="n">h</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048611</span>                 <span class="k">and</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">3</span><span class="n">Fh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048616</span>                 <span class="k">leave</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048617</span>                 <span class="k">retn</span>    <span class="mi">8</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048617</span> <span class="n">get_offset1</span>     <span class="n">endp</span></pre></td></tr></tbody></table></code></pre></figure>

<p>get_offset2:</p>

<figure class="highlight"><pre><code class="language-nasm" data-lang="nasm"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048645</span>                 <span class="k">xor</span>     <span class="n">al</span><span class="p">,</span> <span class="mi">2</span><span class="n">Fh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048647</span>                 <span class="k">and</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">3</span><span class="n">Fh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804864</span><span class="n">C</span>                 <span class="k">leave</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804864</span><span class="n">D</span>                 <span class="k">retn</span>    <span class="mi">8</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804864</span><span class="n">D</span> <span class="n">get_offset2</span>     <span class="n">endp</span></pre></td></tr></tbody></table></code></pre></figure>

<p>get_offset3:</p>

<figure class="highlight"><pre><code class="language-nasm" data-lang="nasm"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048678</span>                 <span class="k">xor</span>     <span class="n">al</span><span class="p">,</span> <span class="mi">0</span><span class="n">EDh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804867</span><span class="n">A</span>                 <span class="k">push</span>    <span class="n">eax</span>             <span class="c">; seed</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804867</span><span class="n">B</span>                 <span class="k">call</span>    <span class="n">_srand</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048680</span>                 <span class="k">call</span>    <span class="n">_rand</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048685</span>                 <span class="k">and</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">3</span><span class="n">Fh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804868</span><span class="n">A</span>                 <span class="k">leave</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804868</span><span class="n">B</span>                 <span class="k">retn</span>    <span class="mi">8</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">0804868</span><span class="n">B</span> <span class="n">get_offset3</span>     <span class="n">endp</span></pre></td></tr></tbody></table></code></pre></figure>

<p>get_offset4:</p>

<figure class="highlight"><pre><code class="language-nasm" data-lang="nasm"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080486</span><span class="n">C6</span>                 <span class="k">xor</span>     <span class="n">al</span><span class="p">,</span> <span class="mi">77</span><span class="n">h</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080486</span><span class="n">C8</span>                 <span class="k">and</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">3</span><span class="n">Fh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080486</span><span class="n">CD</span>                 <span class="k">leave</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080486</span><span class="n">CE</span>                 <span class="k">retn</span>    <span class="mi">8</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080486</span><span class="n">CE</span> <span class="n">get_offset4</span>     <span class="n">endp</span></pre></td></tr></tbody></table></code></pre></figure>

<p>get_offset5:</p>

<figure class="highlight"><pre><code class="language-nasm" data-lang="nasm"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">080486</span><span class="n">FF</span>                 <span class="k">and</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">3</span><span class="n">Fh</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048704</span>                 <span class="k">leave</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048705</span>                 <span class="k">retn</span>    <span class="mi">4</span>
<span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="mi">08048705</span> <span class="n">get_offset5</span>     <span class="n">endp</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Vous vous souvenez de nos 6 octets “changeant”?</p>

<ul>
  <li>octets: 0x13, 0x84, 0x2f, 0xed, 0x77, 0x57</li>
</ul>

<p>Eh oui, ce sont les “clés” utilisées par les fonctions de calcul d’offset.</p>

<p>En fait, le keygenme va faire les choses suivantes:</p>

<ul>
  <li>vérification de la longueur de l’username</li>
  <li>vérification de la longueur du serial
  -&gt; bye bye si pas égal à 6</li>
  <li>calculs des offsets en utilisant les 6 bytes</li>
  <li>calcul du sérial</li>
  <li>comparaison entre le serial rentré et le sérial calculé</li>
  <li>bravo ou exit</li>
</ul>

<p>On se rend compte que pour calculer les différents offsets, le serial est utilisé.
Je suis parti dans l’idée d’utiliser l’username pour générer le serial.</p>

<p>Et voilà, reste plus qu’à coder un beau keygen ;).</p>

<p>Have fun,</p>

<p>m_101</p>

<h1 id="ressources">Ressources</h1>

<ul>
  <li>Mon keygen: <a href="http://www.mediafire.com/?t4tialo6g2l879k">Keygen</a> or <a href="/binholic/assets/others/ge0s-keygenme.zip">here</a></li>
</ul>

  </div>

  <div class="post-navigation">
    
    <a class="post-prev" href="/binholic/2010/12/11/exploit-powershell-301-0day.html">Previous : [Exploit] PowerShell 3.01 0day</a>
    

    
    <a class="post-next" href="/binholic/2011/02/03/exploitation-novactf-january-2011.html">Next : [Exploitation] NovaCTF January 2011</a>
    
  </div>

  
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
            this.page.url = "http://binholic.com/2011/02/02/reversing-ge0s-keygenme-fast.html";
            this.page.identifier = "/2011/02/02/reversing-ge0s-keygenme-fast";
        };

        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//binholic.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

      <div class="site-footer">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/m101"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/w_levin"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span></a>

          </li>
          

          
          <li>
            <a href="mailto:m101.sec@gmail.com"><span class="icon icon--email"><?xml version="1.0" encoding="UTF-8"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="240.665px" height="250px" viewBox="43.833 205.167 240.665 250" enable-background="new 43.833 205.167 240.665 250" xml:space="preserve">
<g>
	<path fill="#323232" d="M221.459,396.62c-8.84,0-15.904-2.21-21.191-6.63c-5.289-4.42-8.449-10.441-9.488-18.07   c-4.855,5.895-10.66,10.965-17.42,15.21c-6.762,4.249-14.561,6.37-23.4,6.37c-6.59,0-12.83-1.256-18.72-3.77   c-5.895-2.512-11.095-6.15-15.6-10.92c-4.509-4.766-8.105-10.571-10.79-17.42c-2.689-6.846-4.03-14.69-4.03-23.531   c0-9.879,1.56-19.064,4.68-27.56c3.12-8.49,7.365-15.86,12.74-22.1c5.371-6.24,11.7-11.136,18.98-14.69   c7.28-3.551,15.08-5.33,23.4-5.33c9.01,0,16.68,1.82,23.01,5.461c6.324,3.639,11.311,8.234,14.949,13.779l2.34-17.42h20.541   l-10.66,85.02c-0.52,3.99-0.781,7.021-0.781,9.101c0,5.029,1.041,8.929,3.121,11.7c2.08,2.774,5.545,4.16,10.4,4.16   c4.504,0,8.84-1.646,13-4.94c4.16-3.29,7.799-7.931,10.92-13.91c3.119-5.979,5.589-13.085,7.41-21.319   c1.82-8.23,2.729-17.291,2.729-27.17c0-11.961-2.123-23.051-6.369-33.281c-4.25-10.225-10.228-19.064-17.939-26.52   c-7.715-7.451-16.859-13.26-27.43-17.42c-10.576-4.16-22.189-6.24-34.842-6.24c-16.119,0-30.464,3.165-43.029,9.49   c-12.57,6.33-23.14,14.605-31.72,24.83c-8.58,10.229-15.08,21.799-19.5,34.71c-4.42,12.915-6.63,26.045-6.63,39.39   c0,15.08,2.34,28.516,7.02,40.301c4.68,11.789,11.18,21.795,19.5,30.029c8.32,8.23,18.11,14.471,29.38,18.721   c11.265,4.244,23.485,6.369,36.661,6.369c13.17,0,24.914-1.561,35.229-4.68c10.311-3.121,20.15-6.936,29.512-11.439l7.539,19.76   c-9.016,4.85-19.891,8.924-32.631,12.219c-12.738,3.291-26.479,4.941-41.209,4.941c-16.64,0-31.98-2.516-46.02-7.541   c-14.04-5.029-26.175-12.439-36.4-22.23c-10.229-9.795-18.2-21.84-23.92-36.139c-5.72-14.301-8.58-30.811-8.58-49.53   c0-17.331,2.99-33.841,8.97-49.53c5.98-15.686,14.471-29.51,25.48-41.47c11.005-11.96,24.266-21.45,39.78-28.47   c15.51-7.02,32.889-10.53,52.129-10.53c16.291,0,31.156,2.645,44.59,7.93c13.432,5.29,24.916,12.524,34.451,21.71   c9.529,9.189,16.898,20.064,22.1,32.63c5.199,12.568,7.799,26.129,7.799,40.689c0,12.48-1.518,23.965-4.549,34.45   c-3.035,10.489-7.195,19.5-12.48,27.04c-5.289,7.54-11.615,13.391-18.98,17.55C238.139,394.54,230.124,396.62,221.459,396.62z    M156.979,374.26c6.76,0,13-1.86,18.721-5.59c5.719-3.725,10.311-7.756,13.779-12.09l6.24-51.48   c-3.469-5.545-7.975-10.051-13.52-13.52c-5.551-3.465-11.875-5.2-18.98-5.2c-5.201,0-10.23,1.17-15.08,3.511   c-4.855,2.34-9.145,5.635-12.87,9.879c-3.729,4.25-6.675,9.32-8.84,15.211c-2.169,5.895-3.25,12.395-3.25,19.5   c0,13.174,3.291,23.1,9.88,29.77C139.645,370.925,147.62,374.26,156.979,374.26z"/>
</g>
</svg></span></a>

          </li>
          

          
          <li>
            <a href="http://127.0.0.1:8888/USK@ABR8mm2t1L1G8cBG70cDy4PHFO6LPV~LrA-RIZxgOGI,pnGWUxb7k8~5-ywwqnBakTXx5ZFw6QzzZj7H~45NgE8,AQACAAE/binholic/-1/"><span class="icon icon--freenet"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->
<svg
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   version="1.0"
   width="79.12"
   height="52.64">
  <defs/>
  <g
     transform="translate(-47.495719,-111.30691)">
    <path
       d="M 80.03,122.66 C 94.49,107.06 104.32,113.99 87.53,124.89 C 82.19,128.36 83.58,129.37 87.17,128.82 C 92.24,128.05 95.01,129.02 96.24,129.98 C 99.18,132.28 100.65,130.57 101.64,128.82 C 103.61,125.35 110.25,129.12 105.39,132.75 C 101.59,135.58 102.12,138.77 105.57,140.61 C 111.96,144.01 126.30,150.75 124.14,157.93 C 123.26,160.86 121.67,163.62 118.07,159.89 C 111.32,152.92 106.83,146.97 91.28,144.54 C 81.24,142.96 71.15,140.33 61.46,145.25 C 56.90,147.67 51.16,149.23 49.94,146.37 C 48.35,142.64 56.47,139.57 64.32,138.82 C 69.42,138.33 73.99,134.99 67.00,133.29 C 58.39,130.64 68.28,123.09 74.50,124.89 C 78.55,126.07 78.95,123.83 80.03,122.66 z"
       style="fill:#ffffff;stroke:#356ace;stroke-width:1.5;" />
  </g>
</svg>
</span></a>

          </li>
          
        </ul>
      </div>

    </div>

  </div>

</footer>


  </body>

</html>
